openapi: 3.0.3
info:
  title: Billiard POS Platform API
  version: 0.1.0
servers:
- url: https://api.example.com
security:
- bearerAuth: []
paths:
  /auth/login:
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/_auth_login_post_request"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
          description: OK
      summary: Login and receive JWT tokens
      x-content-type: application/json
      x-accepts:
      - application/json
  /owners/signup:
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OwnerSignup"
        required: true
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Shop"
          description: Created
      summary: Owner self sign-up and create FREE shop
      x-content-type: application/json
      x-accepts:
      - application/json
  /admin/shops:
    post:
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Shop"
          description: Created
      summary: Create shop (Admin)
      x-accepts:
      - application/json
  /admin/shops/{shopId}:
    patch:
      parameters:
      - explode: false
        in: path
        name: shopId
        required: true
        schema:
          format: uuid
          type: string
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AdminShopPatch"
        required: true
      responses:
        "200":
          description: Updated
      summary: Update plan/status/quota for a shop (Admin)
      x-content-type: application/json
      x-accepts:
      - application/json
  /shops/{shopId}/staff:
    post:
      parameters:
      - explode: false
        in: path
        name: shopId
        required: true
        schema:
          format: uuid
          type: string
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateStaff"
        required: true
      responses:
        "201":
          description: Created
      summary: Invite/create staff under a shop (Owner)
      x-content-type: application/json
      x-accepts:
      - application/json
  /shops/{shopId}/upgrade:
    post:
      parameters:
      - explode: false
        in: path
        name: shopId
        required: true
        schema:
          format: uuid
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaymentSession"
          description: Payment session created
      summary: Start upgrade to Premium (Owner)
      x-accepts:
      - application/json
  /billing/webhook:
    post:
      responses:
        "200":
          description: OK
      summary: Payment provider webhook (Admin scope)
      x-accepts:
      - application/json
  /tables:
    get:
      parameters:
      - explode: true
        in: query
        name: shop_id
        required: false
        schema:
          format: uuid
          type: string
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                items:
                  $ref: "#/components/schemas/Table"
                type: array
          description: OK
      summary: List tables by shop
      x-accepts:
      - application/json
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Table"
        required: true
      responses:
        "201":
          description: Created
      summary: Create table (Owner)
      x-content-type: application/json
      x-accepts:
      - application/json
  /tables/{tableId}:
    patch:
      parameters:
      - explode: false
        in: path
        name: tableId
        required: true
        schema:
          format: uuid
          type: string
        style: simple
      responses:
        "200":
          description: Updated
      summary: Update table (Owner)
      x-accepts:
      - application/json
  /sessions:
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OpenSession"
        required: true
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Session"
          description: Created
      summary: Open session (POS)
      x-content-type: application/json
      x-accepts:
      - application/json
  /sessions/{sessionId}:
    patch:
      parameters:
      - explode: false
        in: path
        name: sessionId
        required: true
        schema:
          format: uuid
          type: string
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/_sessions__sessionId__patch_request"
        required: true
      responses:
        "200":
          description: Updated
      summary: Pause/Resume/Transfer/Close session (POS)
      x-content-type: application/json
      x-accepts:
      - application/json
  /pricing/quote:
    get:
      parameters:
      - explode: true
        in: query
        name: shop_id
        required: false
        schema:
          format: uuid
          type: string
        style: form
      - explode: true
        in: query
        name: tableType
        required: false
        schema:
          type: string
        style: form
      - explode: true
        in: query
        name: at
        required: false
        schema:
          format: date-time
          type: string
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/_pricing_quote_get_200_response"
          description: OK
      summary: Get price quote for a time instant
      x-accepts:
      - application/json
  /bills:
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Bill"
        required: true
      responses:
        "201":
          description: Created
      summary: Create bill
      x-content-type: application/json
      x-accepts:
      - application/json
  /bills/{billId}/pay:
    post:
      parameters:
      - explode: false
        in: path
        name: billId
        required: true
        schema:
          format: uuid
          type: string
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/_bills__billId__pay_post_request"
        required: true
      responses:
        "200":
          description: Paid
      summary: Pay a bill
      x-content-type: application/json
      x-accepts:
      - application/json
  /bills/{billId}/split:
    post:
      parameters:
      - explode: false
        in: path
        name: billId
        required: true
        schema:
          format: uuid
          type: string
        style: simple
      responses:
        "200":
          description: Split OK
      summary: Split a bill
      x-accepts:
      - application/json
  /bills/{billId}/print:
    post:
      parameters:
      - explode: false
        in: path
        name: billId
        required: true
        schema:
          format: uuid
          type: string
        style: simple
      responses:
        "200":
          description: Printed
      summary: Print bill via ESC/POS
      x-accepts:
      - application/json
  /payments/qr:
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreatePaymentIntent"
        required: true
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaymentIntent"
          description: Created
      summary: Create QR payment intent
      x-content-type: application/json
      x-accepts:
      - application/json
  /payments/webhook:
    post:
      responses:
        "200":
          description: OK
      summary: Payment provider callback
      x-accepts:
      - application/json
  /products:
    get:
      parameters:
      - explode: true
        in: query
        name: shop_id
        required: false
        schema:
          format: uuid
          type: string
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                items:
                  $ref: "#/components/schemas/Product"
                type: array
          description: OK
      summary: List products by shop
      x-accepts:
      - application/json
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Product"
        required: true
      responses:
        "201":
          description: Created
      summary: Create product (Owner)
      x-content-type: application/json
      x-accepts:
      - application/json
  /inventory/txns:
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InventoryTxn"
        required: true
      responses:
        "201":
          description: Created
      summary: Create inventory transaction
      x-content-type: application/json
      x-accepts:
      - application/json
  /reports/revenue:
    get:
      parameters:
      - explode: true
        in: query
        name: shop_id
        required: false
        schema:
          format: uuid
          type: string
        style: form
      - explode: true
        in: query
        name: from
        required: false
        schema:
          format: date-time
          type: string
        style: form
      - explode: true
        in: query
        name: to
        required: false
        schema:
          format: date-time
          type: string
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RevenueReport"
          description: OK
      summary: Revenue report
      x-accepts:
      - application/json
  /reports/occupancy:
    get:
      parameters:
      - explode: true
        in: query
        name: shop_id
        required: false
        schema:
          format: uuid
          type: string
        style: form
      - explode: true
        in: query
        name: from
        required: false
        schema:
          format: date-time
          type: string
        style: form
      - explode: true
        in: query
        name: to
        required: false
        schema:
          format: date-time
          type: string
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OccupancyReport"
          description: OK
      summary: Occupancy report
      x-accepts:
      - application/json
  /reports/stockvalue:
    get:
      parameters:
      - explode: true
        in: query
        name: shop_id
        required: false
        schema:
          format: uuid
          type: string
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StockValueReport"
          description: OK
      summary: Stock value report
      x-accepts:
      - application/json
  /admin/audit:
    get:
      parameters:
      - explode: true
        in: query
        name: shop_id
        required: false
        schema:
          format: uuid
          type: string
        style: form
      - explode: true
        in: query
        name: actor
        required: false
        schema:
          format: uuid
          type: string
        style: form
      - explode: true
        in: query
        name: action
        required: false
        schema:
          type: string
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                items:
                  $ref: "#/components/schemas/AuditLog"
                type: array
          description: OK
      summary: Audit logs (Admin)
      x-accepts:
      - application/json
components:
  schemas:
    AuthResponse:
      example:
        access_token: access_token
        refresh_token: refresh_token
        shop_id: shop_id
        role: ADMIN
      properties:
        access_token:
          type: string
        refresh_token:
          type: string
        role:
          enum:
          - ADMIN
          - OWNER
          - STAFF
          type: string
        shop_id:
          nullable: true
          type: string
      type: object
    OwnerSignup:
      example:
        password: password
        shop_name: shop_name
        email: email
      properties:
        email:
          format: email
          type: string
        password:
          type: string
        shop_name:
          type: string
      required:
      - email
      - password
      - shop_name
      type: object
    AdminShopPatch:
      example:
        quota_json:
          key: ""
        plan: FREE
        status: active
      properties:
        status:
          enum:
          - active
          - locked
          - archived
          type: string
        plan:
          enum:
          - FREE
          - PREMIUM
          - SUSPENDED
          type: string
        quota_json:
          additionalProperties: true
          type: object
      type: object
    CreateStaff:
      example:
        display_name: display_name
        email: email
      properties:
        email:
          format: email
          type: string
        display_name:
          type: string
      required:
      - email
      type: object
    Shop:
      example:
        quota_json: "{}"
        name: name
        id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        plan: plan
        status: status
      properties:
        id:
          format: uuid
          type: string
        name:
          type: string
        status:
          type: string
        plan:
          type: string
        quota_json:
          type: object
      type: object
    Table:
      example:
        area: area
        shop_id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        code: code
        id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        type: POOL
        status: IDLE
      properties:
        id:
          format: uuid
          type: string
        shop_id:
          format: uuid
          type: string
        code:
          type: string
        type:
          enum:
          - POOL
          - SNOOKER
          - CAROM
          type: string
        area:
          type: string
        status:
          enum:
          - IDLE
          - BUSY
          - PAUSED
          - CLEANING
          type: string
      type: object
    OpenSession:
      example:
        shop_id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        table_id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
      properties:
        shop_id:
          format: uuid
          type: string
        table_id:
          format: uuid
          type: string
      required:
      - shop_id
      - table_id
      type: object
    Session:
      example:
        shop_id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        end_at: 2000-01-23T04:56:07.000+00:00
        computed_fee: 6.027456183070403
        id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        state: OPEN
        table_id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        start_at: 2000-01-23T04:56:07.000+00:00
        pause_total_s: 0
      properties:
        id:
          format: uuid
          type: string
        shop_id:
          format: uuid
          type: string
        table_id:
          format: uuid
          type: string
        start_at:
          format: date-time
          type: string
        pause_total_s:
          type: integer
        end_at:
          format: date-time
          nullable: true
          type: string
        computed_fee:
          type: number
        state:
          enum:
          - OPEN
          - PAUSED
          - CLOSED
          type: string
      type: object
    Bill:
      example:
        shop_id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        code: code
        payments_json: "{}"
        discount: 1.4658129805029452
        item_total: 6.027456183070403
        id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        session_total: 0.8008281904610115
        status: OPEN
      properties:
        id:
          format: uuid
          type: string
        shop_id:
          format: uuid
          type: string
        code:
          type: string
        session_total:
          type: number
        item_total:
          type: number
        discount:
          type: number
        payments_json:
          type: object
        status:
          enum:
          - OPEN
          - PAID
          - VOID
          type: string
      type: object
    Product:
      example:
        shop_id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        uom: uom
        cost: 6.027456183070403
        price: 0.8008281904610115
        stock_qty: 1.4658129805029452
        name: name
        active: true
        min_stock: 5.962133916683182
        id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        sku: sku
        category: category
        tax_rate: 5.637376656633329
      properties:
        id:
          format: uuid
          type: string
        shop_id:
          format: uuid
          type: string
        sku:
          type: string
        name:
          type: string
        category:
          type: string
        uom:
          type: string
        price:
          type: number
        cost:
          type: number
        stock_qty:
          type: number
        min_stock:
          type: number
        tax_rate:
          type: number
        active:
          type: boolean
      type: object
    InventoryTxn:
      example:
        shop_id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        reason: reason
        cost: 6.027456183070403
        product_id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        qty: 0.8008281904610115
        id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        type: IN
        ts: 2000-01-23T04:56:07.000+00:00
      properties:
        id:
          format: uuid
          type: string
        shop_id:
          format: uuid
          type: string
        product_id:
          format: uuid
          type: string
        type:
          enum:
          - IN
          - OUT
          - ADJ
          type: string
        qty:
          type: number
        cost:
          type: number
        reason:
          type: string
        ts:
          format: date-time
          type: string
      type: object
    CreatePaymentIntent:
      example:
        bill_id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        shop_id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        amount: 0.8008281904610115
        provider: momo
      properties:
        shop_id:
          format: uuid
          type: string
        bill_id:
          format: uuid
          type: string
        amount:
          type: number
        provider:
          enum:
          - momo
          - zalopay
          - bankqr
          type: string
      required:
      - amount
      - bill_id
      - provider
      - shop_id
      type: object
    PaymentIntent:
      example:
        amount: 0.8008281904610115
        id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        qr_payload: qr_payload
        status: created
      properties:
        id:
          format: uuid
          type: string
        qr_payload:
          type: string
        amount:
          type: number
        status:
          enum:
          - created
          - paid
          - failed
          type: string
      type: object
    PaymentSession:
      example:
        checkout_url: checkout_url
        session_id: session_id
      properties:
        session_id:
          type: string
        checkout_url:
          type: string
      type: object
    RevenueReport:
      example:
        totals_by_day:
        - revenue: 0.8008281904610115
          day: 2000-01-23
        - revenue: 0.8008281904610115
          day: 2000-01-23
        from: 2000-01-23T04:56:07.000+00:00
        to: 2000-01-23T04:56:07.000+00:00
      properties:
        from:
          format: date-time
          type: string
        to:
          format: date-time
          type: string
        totals_by_day:
          items:
            $ref: "#/components/schemas/RevenueReport_totals_by_day_inner"
          type: array
      type: object
    OccupancyReport:
      example:
        slots:
        - occupancy_pct: 0.8008281904610115
          slot: slot
        - occupancy_pct: 0.8008281904610115
          slot: slot
      properties:
        slots:
          items:
            $ref: "#/components/schemas/OccupancyReport_slots_inner"
          type: array
      type: object
    StockValueReport:
      example:
        total_value: 0.8008281904610115
        by_category:
        - category: category
          value: 6.027456183070403
        - category: category
          value: 6.027456183070403
      properties:
        total_value:
          type: number
        by_category:
          items:
            $ref: "#/components/schemas/StockValueReport_by_category_inner"
          type: array
      type: object
    AuditLog:
      example:
        actor_user_id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        shop_id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        action: action
        id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        entity_id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        meta_json: "{}"
        entity: entity
        ts: 2000-01-23T04:56:07.000+00:00
      properties:
        id:
          format: uuid
          type: string
        actor_user_id:
          format: uuid
          type: string
        shop_id:
          format: uuid
          nullable: true
          type: string
        action:
          type: string
        entity:
          type: string
        entity_id:
          format: uuid
          nullable: true
          type: string
        meta_json:
          type: object
        ts:
          format: date-time
          type: string
      type: object
    _auth_login_post_request:
      properties:
        email:
          format: email
          type: string
        password:
          type: string
      type: object
    _sessions__sessionId__patch_request:
      properties:
        op:
          enum:
          - pause
          - resume
          - transfer
          - close
          type: string
        to_table_id:
          format: uuid
          type: string
      type: object
    _pricing_quote_get_200_response:
      example:
        rounding_block: 6
        unit_price: 0.8008281904610115
      properties:
        unit_price:
          type: number
        rounding_block:
          type: integer
      type: object
    _bills__billId__pay_post_request:
      properties:
        method:
          enum:
          - cash
          - qr
          type: string
        amount:
          type: number
      type: object
    RevenueReport_totals_by_day_inner:
      example:
        revenue: 0.8008281904610115
        day: 2000-01-23
      properties:
        day:
          format: date
          type: string
        revenue:
          type: number
      type: object
    OccupancyReport_slots_inner:
      example:
        occupancy_pct: 0.8008281904610115
        slot: slot
      properties:
        slot:
          type: string
        occupancy_pct:
          type: number
      type: object
    StockValueReport_by_category_inner:
      example:
        category: category
        value: 6.027456183070403
      properties:
        category:
          type: string
        value:
          type: number
      type: object
  securitySchemes:
    bearerAuth:
      bearerFormat: JWT
      scheme: bearer
      type: http
